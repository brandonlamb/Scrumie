<style>
    .dialog {display: none;}
    input.text {width: 180px;}
    .hidden {display: none;}
    #registryDialog {margin-top: 10px;}
    .loginDialog div.ui-dialog-titlebar {display: none;}
    h1 {font-size: 18px}
</style>
<center>
<div id="loginDialog" class="dialog">
    <h1>Scrumie</h1>
    <form id="loginForm" onsubmit="return false;">
    <table>
    <tr><td>Login:</td><td><input class="text" tabindex="1" name="login" type="text"/></td></tr>
    <tr><td>Password:</td><td><input class="text" tabindex="2" name="password" type="password"/></td></tr>
    <tr><td></td><td style="text-align: right"><a style="margin-right: 10px;" href="javascript: showRegistryDialog();">Create account</a><input tabindex="3" type="submit" value="Login" /></td></tr>
    </table>
    <div style="font-size: 11px;">

    <strong>Recent changes</strong>
    <ul style="margin: 2px">
        <li>17 Sep 2011 - Delete/untouch projects</li>
        <li>5 Sep 2011 - Change project login to user login (If you have projects already create new user account then import your projects to it)</li>
    </ul>

    <strong>What next</strong>
    <ul style="margin: 2px">
        <li>Additional colors for sticky notes</li>
        <li>Public link for project</li>
        <li>Add user stories</li>
    </ul>

    </div>
    <br/><small><a href="https://github.com/nigro/Scrumie">http:://github.com/nigro/Scrumie</a></small>
    </form>




    <div id="registryDialog" class="hidden">
        <form id="registryForm" onsubmit="return false;">
            <table>
                <tr><td>Login:</td><td><input class="text" name="login" type="text"/></td></tr>
                <tr><td>Password:</td><td><input class="text" name="password" type="password"/></td></tr>
                <tr><td>Repeat&nbsp;pwd:</td><td><input class="text" name="password2" type="password"/></td></tr>
                <tr><td></td><td style="text-align: right"><input type="submit" value="Create" /></td></tr>
            </table>
        </form>
    </div>

</div>
</center>

<script>
$(document).ready(function() {
    showLoginDialog();

    $('form#registryForm input[type="submit"]').click(function() {
        var formData = $('form#registryForm').serializeArray();
        $.post(uri('User', 'registry'), formData, function(data, textStatus, Request) {
            if(data === true) {
                $('#loginForm input[name=login]').val($('#registryForm input[name=login]').val());
                $('#loginForm input[name=password]').val($('#registryForm input[name=password]').val());
                $('#loginForm input[type=submit]').click();
                alert("Registration success.\nYou can now login to your account");
            }
            else {
                alert(data.error)
            }
        });

        return false;
    });

    $('form#loginForm input[type="submit"]').click(function() {
        var formData = $('form#loginForm').serializeArray();
        $.post(uri('User', 'login'), formData, function(data, textStatus, Request) {
            if(data === true) {
                location.href = uri('Board', 'index');
            }
            else {
                alert('Authorization failed');
            }
        });

        return false;
    });
});

function showLoginDialog() {
    loginDialog = $( "#loginDialog" ).dialog({
        closeOnEscape: false,
        draggable: false,
        resizable: false,
        dialogClass: 'loginDialog',
    });
}

function showRegistryDialog() {
    $( "#registryDialog" ).removeClass('hidden');
    $("#registryDialog").find('input[name=login]').focus();
}
</script>
